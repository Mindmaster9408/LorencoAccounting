<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lorenco Ecosystem â€” Login</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            overflow: hidden;
            position: relative;
        }

        /* Animated background particles */
        .bg-particles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            animation: float 20s infinite ease-in-out;
        }
        .particle:nth-child(1) { width: 300px; height: 300px; top: -50px; left: -50px; animation-delay: 0s; }
        .particle:nth-child(2) { width: 200px; height: 200px; top: 50%; right: -40px; animation-delay: -5s; }
        .particle:nth-child(3) { width: 150px; height: 150px; bottom: -30px; left: 30%; animation-delay: -10s; }
        .particle:nth-child(4) { width: 250px; height: 250px; top: 20%; left: 60%; animation-delay: -15s; }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.03; }
            50% { transform: translateY(-40px) rotate(180deg); opacity: 0.08; }
        }

        .login-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 460px;
            padding: 20px;
        }

        /* Logo / Brand */
        .brand {
            text-align: center;
            margin-bottom: 40px;
        }
        .brand-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            font-size: 36px;
            color: white;
            transform: rotate(-5deg);
            transition: transform 0.3s;
        }
        .brand-icon:hover { transform: rotate(0deg) scale(1.05); }
        .brand h1 {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        .brand p {
            color: rgba(255,255,255,0.5);
            font-size: 0.95rem;
            margin-top: 6px;
        }

        /* Card */
        .login-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 24px;
            padding: 40px 36px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-card h2 {
            color: white;
            font-size: 1.4rem;
            margin-bottom: 8px;
        }
        .login-card .subtitle {
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
            margin-bottom: 28px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        .form-group label {
            display: block;
            color: rgba(255,255,255,0.7);
            font-size: 0.82rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 8px;
        }
        .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            outline: none;
        }
        .form-group input::placeholder {
            color: rgba(255,255,255,0.3);
        }
        .form-group input:focus {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.08);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }

        .form-group .toggle-password {
            position: absolute;
            right: 14px;
            top: 38px;
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            font-size: 1.1rem;
            user-select: none;
        }
        .form-group .toggle-password:hover { color: rgba(255,255,255,0.7); }

        .remember-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .remember-row label {
            color: rgba(255,255,255,0.6);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .remember-row input[type="checkbox"] {
            accent-color: #667eea;
            width: 16px;
            height: 16px;
        }

        .btn-login {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .btn-login:active { transform: translateY(0); }
        .btn-login:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .btn-login .spinner {
            display: none;
            width: 20px; height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }
        .btn-login.loading .btn-text { display: none; }
        .btn-login.loading .spinner { display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .error-msg {
            display: none;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.88rem;
            margin-bottom: 20px;
            text-align: center;
        }
        .error-msg.show { display: block; }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            margin: 28px 0;
            gap: 16px;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255,255,255,0.1);
        }
        .divider span {
            color: rgba(255,255,255,0.35);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Direct app links */
        .app-links {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        .app-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            font-size: 0.82rem;
            transition: all 0.2s;
        }
        .app-link:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.15);
            color: white;
        }
        .app-link .icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .app-link.pos .icon { background: rgba(59, 130, 246, 0.2); }
        .app-link.payroll .icon { background: rgba(16, 185, 129, 0.2); }
        .app-link.accounting .icon { background: rgba(245, 158, 11, 0.2); }

        /* â”€â”€ Register Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn-register {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: 2px solid rgba(102, 126, 234, 0.4);
            color: #a3b1f0;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 14px;
        }
        .btn-register:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            color: white;
            transform: translateY(-2px);
        }

        /* â”€â”€ Registration Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .reg-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 12, 41, 0.92);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 500;
            align-items: flex-start;
            justify-content: center;
            padding: 30px 20px;
            overflow-y: auto;
        }
        .reg-overlay.show { display: flex; }
        .reg-modal {
            background: #1e1b3a;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            width: 100%;
            max-width: 560px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
            margin: auto;
        }
        .reg-header {
            padding: 28px 28px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .reg-header h2 {
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
        }
        .reg-close {
            width: 36px; height: 36px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.5);
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .reg-close:hover { background: rgba(239,68,68,0.2); color: #fca5a5; }
        .reg-body { padding: 24px 28px 28px; }

        /* â”€â”€ Steps / Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .reg-steps {
            display: flex;
            gap: 8px;
            margin-bottom: 28px;
        }
        .reg-step {
            flex: 1;
            height: 4px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            transition: background 0.3s;
        }
        .reg-step.active { background: linear-gradient(135deg, #667eea, #764ba2); }
        .reg-step.done { background: #10b981; }

        /* â”€â”€ Type Selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .type-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-bottom: 24px;
        }
        .type-card {
            padding: 24px 18px;
            background: rgba(255,255,255,0.04);
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s;
        }
        .type-card:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }
        .type-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.12);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }
        .type-card .type-icon {
            font-size: 2.4rem;
            margin-bottom: 10px;
        }
        .type-card .type-title {
            color: white;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        .type-card .type-desc {
            color: rgba(255,255,255,0.5);
            font-size: 0.78rem;
            line-height: 1.4;
        }

        /* â”€â”€ Reg Form Fields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .reg-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-bottom: 14px;
        }
        .reg-row.full { grid-template-columns: 1fr; }
        .reg-field label {
            display: block;
            color: rgba(255,255,255,0.6);
            font-size: 0.78rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .reg-field input, .reg-field select {
            width: 100%;
            padding: 12px 14px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        .reg-field input::placeholder { color: rgba(255,255,255,0.3); }
        .reg-field input:focus, .reg-field select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.06);
        }
        .reg-field select option { background: #1e1b3a; color: white; }

        /* â”€â”€ Step Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .step-panel { display: none; }
        .step-panel.active { display: block; }

        /* â”€â”€ Reg Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .reg-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }
        .btn-reg {
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }
        .btn-reg.back {
            background: transparent;
            color: rgba(255,255,255,0.5);
        }
        .btn-reg.back:hover { color: white; }
        .btn-reg.next {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
        }
        .btn-reg.next:hover { box-shadow: 0 4px 15px rgba(102,126,234,0.4); transform: translateY(-1px); }
        .btn-reg.next:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* â”€â”€ User Row (Add Users step) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .users-list { margin-bottom: 16px; }
        .user-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            margin-bottom: 8px;
        }
        .user-row .user-info { flex: 1; }
        .user-row .user-name { color: white; font-weight: 600; font-size: 0.9rem; }
        .user-row .user-email { color: rgba(255,255,255,0.4); font-size: 0.78rem; }
        .user-row .user-role {
            font-size: 0.72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 10px;
            border-radius: 6px;
            background: rgba(102,126,234,0.15);
            color: #a3b1f0;
        }
        .user-row .btn-remove-user {
            width: 28px; height: 28px;
            background: rgba(239,68,68,0.15);
            border: none;
            border-radius: 8px;
            color: #fca5a5;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .user-row .btn-remove-user:hover { background: rgba(239,68,68,0.3); }
        .add-user-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto auto;
            gap: 10px;
            align-items: end;
        }
        .add-user-form input, .add-user-form select {
            padding: 10px 12px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 10px;
            color: white;
            font-size: 0.85rem;
            font-family: inherit;
        }
        .add-user-form input::placeholder { color: rgba(255,255,255,0.3); }
        .add-user-form input:focus, .add-user-form select:focus {
            outline: none;
            border-color: #667eea;
        }
        .add-user-form select option { background: #1e1b3a; color: white; }
        .btn-add-user {
            padding: 10px 16px;
            background: rgba(16,185,129,0.15);
            border: 1px solid rgba(16,185,129,0.3);
            color: #6ee7b7;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 700;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn-add-user:hover { background: rgba(16,185,129,0.25); }

        .accountant-link-notice {
            padding: 14px 16px;
            background: rgba(102,126,234,0.1);
            border: 1px solid rgba(102,126,234,0.2);
            border-radius: 12px;
            color: #a3b1f0;
            font-size: 0.85rem;
            margin-top: 12px;
            display: none;
        }
        .accountant-link-notice.show { display: block; }

        /* â”€â”€ Success screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .reg-success {
            text-align: center;
            padding: 20px 0;
        }
        .reg-success .icon { font-size: 3.5rem; margin-bottom: 16px; }
        .reg-success h3 { color: white; font-size: 1.3rem; margin-bottom: 8px; }
        .reg-success p { color: rgba(255,255,255,0.5); margin-bottom: 24px; line-height: 1.5; }

        /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 14px 24px;
            background: #10b981;
            color: white;
            border-radius: 14px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 9999;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.error { background: #ef4444; }

        @media (max-width: 500px) {
            .type-cards { grid-template-columns: 1fr; }
            .add-user-form { grid-template-columns: 1fr; }
            .reg-row { grid-template-columns: 1fr; }
        }

        .footer {
            text-align: center;
            margin-top: 24px;
            color: rgba(255,255,255,0.25);
            font-size: 0.75rem;
        }

        /* Account toggle (step 2) */
        .account-toggle {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .toggle-btn {
            flex: 1;
            padding: 10px 12px;
            background: rgba(255,255,255,0.03);
            border: none;
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            font-size: 0.82rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .toggle-btn.active {
            background: linear-gradient(135deg, rgba(16,185,129,0.25), rgba(59,130,246,0.25));
            color: #fff;
        }
        .toggle-btn:hover:not(.active) {
            background: rgba(255,255,255,0.06);
            color: rgba(255,255,255,0.7);
        }
        .existing-verified {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: rgba(16,185,129,0.12);
            border: 1px solid rgba(16,185,129,0.3);
            border-radius: 8px;
            margin-top: 12px;
            color: #10b981;
            font-size: 0.9rem;
        }
        .verified-badge {
            background: #10b981;
            color: #000;
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .login-card { padding: 30px 24px; }
            .brand h1 { font-size: 1.6rem; }
            .app-links { grid-template-columns: 1fr; }
            .reg-modal { width: 95vw; max-height: 90vh; }
            .type-cards { flex-direction: column; }
            .reg-row { flex-direction: column; }
            .add-user-form { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div class="bg-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="login-container">
        <div class="brand">
            <div class="brand-icon">&#9670;</div>
            <h1>Lorenco Ecosystem</h1>
            <p>All your business tools â€” one login</p>
        </div>

        <div class="login-card">
            <h2>Sign In</h2>
            <p class="subtitle">Access your dashboard & all connected apps</p>

            <div class="error-msg" id="errorMsg"></div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email / Username</label>
                    <input type="text" id="loginId" placeholder="you@company.co.za" autocomplete="email" required autofocus>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Enter your password" autocomplete="current-password" required>
                    <span class="toggle-password" onclick="togglePassword()">&#128065;</span>
                </div>

                <div class="remember-row">
                    <label><input type="checkbox" id="rememberMe" checked> Remember me</label>
                </div>

                <button type="submit" class="btn-login" id="btnLogin">
                    <span class="btn-text">Sign In to Ecosystem</span>
                    <span class="spinner"></span>
                </button>
            </form>

            <div class="divider"><span>or login directly to</span></div>

            <div class="app-links">
                <a href="/pos" class="app-link pos">
                    <div class="icon">&#128722;</div>
                    <span>Checkout Charlie</span>
                </a>
                <a href="/payroll/login.html" class="app-link payroll">
                    <div class="icon">&#128176;</div>
                    <span>Lorenco Paytime</span>
                </a>
                <a href="/accounting" class="app-link accounting">
                    <div class="icon">&#128200;</div>
                    <span>Accounting</span>
                </a>
            </div>

            <button type="button" class="btn-register" onclick="openRegister()">
                Create an Account
            </button>
        </div>

        <div class="footer">
            &copy; 2025 The Infinite Legacy &middot; Lorenco Ecosystem v1.0
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- REGISTRATION MODAL                                                  -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="reg-overlay" id="regOverlay">
        <div class="reg-modal">
            <div class="reg-header">
                <h2 id="regTitle">Create Your Account</h2>
                <button class="reg-close" onclick="closeRegister()">âœ•</button>
            </div>
            <div class="reg-body">
                <!-- Progress -->
                <div class="reg-steps" id="regSteps">
                    <div class="reg-step active" data-step="1"></div>
                    <div class="reg-step" data-step="2"></div>
                    <div class="reg-step" data-step="3"></div>
                    <div class="reg-step" data-step="4"></div>
                </div>

                <!-- STEP 1: Choose Account Type -->
                <div class="step-panel active" id="step1">
                    <p style="color:rgba(255,255,255,0.5); margin-bottom:18px; font-size:0.9rem;">
                        What type of account are you creating?
                    </p>
                    <div class="type-cards">
                        <div class="type-card" onclick="selectAccountType('accountant')" id="typeAccountant">
                            <div class="type-icon">ğŸ“‹</div>
                            <div class="type-title">Accounting Practice</div>
                            <div class="type-desc">For accounting firms managing multiple clients</div>
                        </div>
                        <div class="type-card" onclick="selectAccountType('business')" id="typeBusiness">
                            <div class="type-icon">ğŸ¢</div>
                            <div class="type-title">Business Owner</div>
                            <div class="type-desc">For businesses managing their own finances</div>
                        </div>
                    </div>
                    <div class="reg-actions">
                        <button type="button" class="btn-reg next" id="step1Next" disabled onclick="goToStep(2)">Continue â†’</button>
                    </div>
                </div>

                <!-- STEP 2: Your Details (login credentials) -->
                <div class="step-panel" id="step2">
                    <!-- Toggle: new vs existing account -->
                    <div class="account-toggle">
                        <button type="button" class="toggle-btn active" id="toggleNew" onclick="toggleAccountMode('new')">Create New Account</button>
                        <button type="button" class="toggle-btn" id="toggleExisting" onclick="toggleAccountMode('existing')">I Already Have an Account</button>
                    </div>

                    <!-- NEW account fields -->
                    <div id="newAccountFields">
                        <p style="color:rgba(255,255,255,0.5); margin-bottom:18px; font-size:0.9rem;">
                            Create your personal login credentials.
                        </p>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Full Name *</label>
                                <input type="text" id="regFullName" required placeholder="e.g. Ruan van Loggerenberg">
                            </div>
                            <div class="reg-field">
                                <label>Email *</label>
                                <input type="email" id="regEmail" required placeholder="you@company.co.za">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Password *</label>
                                <input type="password" id="regPassword" required placeholder="Min 8 characters">
                            </div>
                            <div class="reg-field">
                                <label>Confirm Password *</label>
                                <input type="password" id="regPasswordConfirm" required placeholder="Repeat password">
                            </div>
                        </div>
                    </div>

                    <!-- EXISTING account fields -->
                    <div id="existingAccountFields" style="display:none;">
                        <p style="color:rgba(255,255,255,0.5); margin-bottom:18px; font-size:0.9rem;">
                            Sign in with your existing account to register a new practice or business.
                        </p>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Email *</label>
                                <input type="email" id="existingEmail" required placeholder="your@email.co.za">
                            </div>
                            <div class="reg-field">
                                <label>Password *</label>
                                <input type="password" id="existingPassword" required placeholder="Your existing password">
                            </div>
                        </div>
                        <div class="existing-verified" id="existingVerified" style="display:none;">
                            <span class="verified-badge">âœ“ Verified</span>
                            <span id="existingUserName"></span>
                        </div>
                    </div>

                    <div class="reg-actions">
                        <button type="button" class="btn-reg back" onclick="goToStep(1)">â† Back</button>
                        <button type="button" class="btn-reg next" onclick="validateStep2()">Continue â†’</button>
                    </div>
                </div>

                <!-- STEP 3: Practice / Business Details -->
                <div class="step-panel" id="step3">
                    <!-- Accountant Practice -->
                    <div id="step3Accountant" style="display:none;">
                        <p style="color:rgba(255,255,255,0.5); margin-bottom:18px; font-size:0.9rem;">
                            Enter your accounting practice details.
                        </p>
                        <div class="reg-row full">
                            <div class="reg-field">
                                <label>Practice Name *</label>
                                <input type="text" id="regPracticeName" placeholder="e.g. Lorenco Accounting Services">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Trading Name</label>
                                <input type="text" id="regPracticeTradingName" placeholder="e.g. Lorenco Accounting">
                            </div>
                            <div class="reg-field">
                                <label>Registration Number</label>
                                <input type="text" id="regPracticeRegNumber" placeholder="e.g. 2024/123456/07">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Tax Number</label>
                                <input type="text" id="regPracticeTaxNumber" placeholder="e.g. 9876543210">
                            </div>
                            <div class="reg-field">
                                <label>Practice Number</label>
                                <input type="text" id="regPracticeNumber" placeholder="IRBA / SAIPA number">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Phone</label>
                                <input type="tel" id="regPracticePhone" placeholder="021 555 0100">
                            </div>
                            <div class="reg-field">
                                <label>Address</label>
                                <input type="text" id="regPracticeAddress" placeholder="Street, City, Code">
                            </div>
                        </div>
                    </div>

                    <!-- Business Owner -->
                    <div id="step3Business" style="display:none;">
                        <p style="color:rgba(255,255,255,0.5); margin-bottom:18px; font-size:0.9rem;">
                            Enter your business details.
                        </p>
                        <div class="reg-row full">
                            <div class="reg-field">
                                <label>Company Name *</label>
                                <input type="text" id="regCompanyName" placeholder="e.g. Green Valley Trading">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Trading Name</label>
                                <input type="text" id="regCompanyTradingName" placeholder="e.g. Green Valley">
                            </div>
                            <div class="reg-field">
                                <label>Registration Number</label>
                                <input type="text" id="regCompanyRegNumber" placeholder="e.g. 2024/654321/07">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Tax Number</label>
                                <input type="text" id="regCompanyTaxNumber" placeholder="e.g. 1234567890">
                            </div>
                            <div class="reg-field">
                                <label>VAT Number</label>
                                <input type="text" id="regCompanyVatNumber" placeholder="If VAT registered">
                            </div>
                        </div>
                        <div class="reg-row">
                            <div class="reg-field">
                                <label>Phone</label>
                                <input type="tel" id="regCompanyPhone" placeholder="021 555 0200">
                            </div>
                            <div class="reg-field">
                                <label>Address</label>
                                <input type="text" id="regCompanyAddress" placeholder="Street, City, Code">
                            </div>
                        </div>
                    </div>

                    <div class="reg-actions">
                        <button type="button" class="btn-reg back" onclick="goToStep(2)">â† Back</button>
                        <button type="button" class="btn-reg next" onclick="validateStep3()">Continue â†’</button>
                    </div>
                </div>

                <!-- STEP 4: Add Users -->
                <div class="step-panel" id="step4">
                    <p style="color:rgba(255,255,255,0.5); margin-bottom:6px; font-size:0.9rem;" id="step4Subtitle">
                        Add team members to your practice (you can also do this later).
                    </p>

                    <div class="users-list" id="usersList">
                        <!-- JS-populated -->
                    </div>

                    <p style="color:rgba(255,255,255,0.4); font-size:0.78rem; margin-bottom:10px; font-weight:600; text-transform:uppercase; letter-spacing:0.5px;">
                        Add a Team Member
                    </p>
                    <div class="add-user-form" id="addUserForm">
                        <input type="text" id="newUserName" placeholder="Full name">
                        <input type="email" id="newUserEmail" placeholder="Email address">
                        <input type="password" id="newUserPassword" placeholder="Password">
                        <select id="newUserRole"></select>
                        <button type="button" class="btn-add-user" onclick="addUserToList()">+ Add</button>
                    </div>

                    <div class="accountant-link-notice" id="accountantLinkNotice">
                        ğŸ”— <strong id="linkedAccountantName"></strong> already has an account.
                        This company will be added to their client list automatically.
                    </div>

                    <div class="reg-actions">
                        <button type="button" class="btn-reg back" onclick="goToStep(3)">â† Back</button>
                        <button type="button" class="btn-reg next" id="regSubmitBtn" onclick="submitRegistration()">
                            Complete Registration
                        </button>
                    </div>
                </div>

                <!-- STEP 5: Success -->
                <div class="step-panel" id="step5">
                    <div class="reg-success">
                        <div class="icon">ğŸ‰</div>
                        <h3>Registration Complete!</h3>
                        <p id="regSuccessMsg">Your account has been created. You can now sign in.</p>
                        <button type="button" class="btn-reg next" onclick="closeRegister(); fillLoginFromReg();">Sign In Now â†’</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = window.location.origin;

        /* â”€â”€ existing session check â”€â”€ */
        (function checkExistingSession() {
            const token = localStorage.getItem('eco_token');
            if (token) {
                fetch(`${API_BASE}/api/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                })
                .then(r => { if (r.ok) return r.json(); throw new Error('expired'); })
                .then(() => { window.location.href = '/dashboard'; })
                .catch(() => { localStorage.removeItem('eco_token'); localStorage.removeItem('eco_user'); });
            }
        })();

        function togglePassword() {
            const pw = document.getElementById('password');
            pw.type = pw.type === 'password' ? 'text' : 'password';
        }

        function showError(msg) {
            const el = document.getElementById('errorMsg');
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 5000);
        }

        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('btnLogin');
            const loginId = document.getElementById('loginId').value.trim();
            const password = document.getElementById('password').value;
            if (!loginId || !password) return showError('Please enter your email and password.');

            btn.classList.add('loading');
            btn.disabled = true;
            try {
                const res = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: loginId, password })
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Login failed');

                localStorage.setItem('eco_token', data.token);
                localStorage.setItem('eco_user', JSON.stringify(data.user));
                if (data.companies) localStorage.setItem('eco_companies', JSON.stringify(data.companies));
                if (data.isSuperAdmin) localStorage.setItem('eco_super_admin', 'true');
                window.location.href = '/dashboard';
            } catch (err) {
                showError(err.message);
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           REGISTRATION FLOW
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        let regState = {
            currentStep: 1,
            accountType: null,       // 'accountant' | 'business'
            accountMode: 'new',      // 'new' | 'existing'
            existingUser: null,      // verified existing user data
            users: [],               // {name, email, role, password, isLinked}
            linkedAccountant: null
        };

        const accountantRoles = [
            { value: 'partner',    label: 'Partner' },
            { value: 'accountant', label: 'Accountant' },
            { value: 'clerk',      label: 'Clerk' },
            { value: 'admin',      label: 'Admin' }
        ];
        const businessRoles = [
            { value: 'owner',      label: 'Owner' },
            { value: 'admin',      label: 'Admin' },
            { value: 'finance',    label: 'Finance' },
            { value: 'accountant', label: 'Accountant' }
        ];

        /* â”€â”€ open / close â”€â”€ */
        function openRegister() {
            document.getElementById('regOverlay').classList.add('show');
            resetRegistration();
        }
        function closeRegister() {
            document.getElementById('regOverlay').classList.remove('show');
        }

        function resetRegistration() {
            regState = { currentStep: 1, accountType: null, accountMode: 'new', existingUser: null, users: [], linkedAccountant: null };
            document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.querySelectorAll('.reg-step').forEach(s => { s.classList.remove('active','done'); });
            document.querySelector('.reg-step[data-step="1"]').classList.add('active');
            document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('step1Next').disabled = true;
            document.getElementById('accountantLinkNotice').style.display = 'none';
            document.getElementById('existingVerified').style.display = 'none';
            toggleAccountMode('new');
            // Clear inputs
            ['regFullName','regEmail','regPassword','regPasswordConfirm',
             'existingEmail','existingPassword',
             'regPracticeName','regPracticeTradingName','regPracticeRegNumber',
             'regPracticeTaxNumber','regPracticeNumber','regPracticePhone','regPracticeAddress',
             'regCompanyName','regCompanyTradingName','regCompanyRegNumber',
             'regCompanyTaxNumber','regCompanyVatNumber','regCompanyPhone','regCompanyAddress',
             'newUserName','newUserEmail','newUserPassword'
            ].forEach(id => { const el = document.getElementById(id); if(el) el.value = ''; });
            document.getElementById('usersList').innerHTML = '';
        }

        /* â”€â”€ account mode toggle (step 2) â”€â”€ */
        function toggleAccountMode(mode) {
            regState.accountMode = mode;
            regState.existingUser = null;
            document.getElementById('toggleNew').classList.toggle('active', mode === 'new');
            document.getElementById('toggleExisting').classList.toggle('active', mode === 'existing');
            document.getElementById('newAccountFields').style.display = mode === 'new' ? 'block' : 'none';
            document.getElementById('existingAccountFields').style.display = mode === 'existing' ? 'block' : 'none';
            document.getElementById('existingVerified').style.display = 'none';
        }

        /* â”€â”€ account type selection (step 1) â”€â”€ */
        function selectAccountType(type) {
            regState.accountType = type;
            document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(type === 'accountant' ? 'typeAccountant' : 'typeBusiness').classList.add('selected');
            document.getElementById('step1Next').disabled = false;
        }

        /* â”€â”€ step navigation â”€â”€ */
        function goToStep(n) {
            document.querySelectorAll('.reg-step').forEach(s => {
                const sn = +s.dataset.step;
                s.classList.remove('active','done');
                if (sn < n) s.classList.add('done');
                if (sn === n) s.classList.add('active');
            });
            document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
            regState.currentStep = n;

            if (n === 3) {
                document.getElementById('step3Accountant').style.display = regState.accountType === 'accountant' ? 'block' : 'none';
                document.getElementById('step3Business').style.display   = regState.accountType === 'business'   ? 'block' : 'none';
            }
            if (n === 4) {
                populateRoleDropdown();
                document.getElementById('step4Subtitle').textContent =
                    regState.accountType === 'accountant'
                        ? 'Add team members to your practice (you can also do this later).'
                        : 'Add team members to your business (you can also do this later).';
            }
        }

        /* â”€â”€ validation helpers â”€â”€ */
        async function validateStep2() {
            if (regState.accountMode === 'existing') {
                // Verify existing account via login
                const email = document.getElementById('existingEmail').value.trim();
                const pw    = document.getElementById('existingPassword').value;

                if (!email) return toast('Please enter your email.', 'error');
                if (!pw)    return toast('Please enter your password.', 'error');

                try {
                    const res = await fetch(`${API_BASE}/api/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password: pw })
                    });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.error || 'Invalid credentials');

                    // Store verified user
                    regState.existingUser = {
                        id: data.user.id,
                        email: data.user.email,
                        full_name: data.user.fullName || data.user.full_name,
                        token: data.token
                    };
                    document.getElementById('existingVerified').style.display = 'flex';
                    document.getElementById('existingUserName').textContent = regState.existingUser.full_name;
                    toast('Account verified! Continuing...', 'info');
                    setTimeout(() => goToStep(3), 800);
                } catch (err) {
                    return toast(err.message, 'error');
                }
                return;
            }

            // New account validation
            const name  = document.getElementById('regFullName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const pw    = document.getElementById('regPassword').value;
            const pw2   = document.getElementById('regPasswordConfirm').value;

            if (!name)                return toast('Please enter your full name.', 'error');
            if (!email)               return toast('Please enter your email address.', 'error');
            if (!/\S+@\S+\.\S+/.test(email)) return toast('Please enter a valid email address.', 'error');
            if (pw.length < 8)        return toast('Password must be at least 8 characters.', 'error');
            if (pw !== pw2)           return toast('Passwords do not match.', 'error');

            goToStep(3);
        }

        function validateStep3() {
            if (regState.accountType === 'accountant') {
                if (!document.getElementById('regPracticeName').value.trim())
                    return toast('Please enter your practice name.', 'error');
            } else {
                if (!document.getElementById('regCompanyName').value.trim())
                    return toast('Please enter your company name.', 'error');
            }
            goToStep(4);
        }

        /* â”€â”€ role dropdown â”€â”€ */
        function populateRoleDropdown() {
            const sel = document.getElementById('newUserRole');
            sel.innerHTML = '<option value="">-- Select Role --</option>';
            const roles = regState.accountType === 'accountant' ? accountantRoles : businessRoles;
            roles.forEach(r => {
                sel.innerHTML += `<option value="${r.value}">${r.label}</option>`;
            });
        }

        /* â”€â”€ add / remove users (step 4) â”€â”€ */
        function addUserToList() {
            const name     = document.getElementById('newUserName').value.trim();
            const email    = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const role     = document.getElementById('newUserRole').value;

            if (!name || !email || !role) return toast('Please fill in name, email and role.', 'error');
            if (!/\S+@\S+\.\S+/.test(email)) return toast('Please enter a valid email.', 'error');
            if (!password || password.length < 6) return toast('Please enter a password (min 6 characters).', 'error');
            if (regState.users.find(u => u.email.toLowerCase() === email.toLowerCase()))
                return toast('This email is already added.', 'error');

            const user = { name, email, password, role, isLinked: false };

            // If business adds someone as accountant, check if they already exist
            if (regState.accountType === 'business' && role === 'accountant') {
                checkAccountantExists(email, name).then(exists => {
                    if (exists) {
                        user.isLinked = true;
                        user.password = null; // existing user keeps their password
                        regState.linkedAccountant = { name: exists.name || name, email };
                    }
                    pushUser(user);
                });
            } else {
                pushUser(user);
            }
        }

        function pushUser(user) {
            regState.users.push(user);
            renderUsers();
            document.getElementById('newUserName').value     = '';
            document.getElementById('newUserEmail').value    = '';
            document.getElementById('newUserPassword').value = '';
            document.getElementById('newUserRole').value     = '';
        }

        function removeUser(idx) {
            const removed = regState.users.splice(idx, 1)[0];
            if (removed && removed.isLinked) {
                regState.linkedAccountant = null;
                document.getElementById('accountantLinkNotice').style.display = 'none';
            }
            renderUsers();
        }

        function renderUsers() {
            const list = document.getElementById('usersList');
            if (regState.users.length === 0) {
                list.innerHTML = '<p style="color:rgba(255,255,255,0.3); text-align:center; padding:12px; font-size:0.85rem;">No team members added yet.</p>';
                return;
            }
            const roleLabels = {};
            [...accountantRoles, ...businessRoles].forEach(r => roleLabels[r.value] = r.label);

            list.innerHTML = regState.users.map((u, i) => `
                <div class="user-row">
                    <div class="user-info">
                        <strong>${u.name}</strong>
                        <span>${u.email}</span>
                    </div>
                    <span class="user-role">${roleLabels[u.role] || u.role}${u.isLinked ? ' ğŸ”—' : ''}</span>
                    <button type="button" onclick="removeUser(${i})" style="background:none;border:none;color:#ef4444;cursor:pointer;font-size:1.1rem;" title="Remove">âœ•</button>
                </div>
            `).join('');
        }

        /* â”€â”€ check if accountant already exists â”€â”€ */
        async function checkAccountantExists(email, fallbackName) {
            try {
                const res = await fetch(`${API_BASE}/api/auth/check-accountant?email=${encodeURIComponent(email)}`);
                if (res.ok) {
                    const data = await res.json();
                    if (data.exists) {
                        const notice = document.getElementById('accountantLinkNotice');
                        document.getElementById('linkedAccountantName').textContent = data.name || fallbackName;
                        notice.style.display = 'flex';
                        return { name: data.name || fallbackName };
                    }
                }
            } catch (e) { /* ignore */ }
            return null;
        }

        /* â”€â”€ submit registration â”€â”€ */
        async function submitRegistration() {
            const btn = document.getElementById('regSubmitBtn');
            btn.disabled = true;
            btn.textContent = 'Creating account\u2026';

            const payload = {
                account_type: regState.accountType,
                users: regState.users.map(u => ({
                    name: u.name,
                    email: u.email,
                    role: u.role,
                    password: u.password || undefined,
                    isLinked: u.isLinked
                }))
            };

            // Existing account mode â€” use verified user ID
            if (regState.accountMode === 'existing' && regState.existingUser) {
                payload.existing_user_id = regState.existingUser.id;
                payload.email = regState.existingUser.email;
                payload.full_name = regState.existingUser.full_name;
                payload.password = '__existing__'; // flag â€” backend won't re-hash
            } else {
                payload.full_name = document.getElementById('regFullName').value.trim();
                payload.email = document.getElementById('regEmail').value.trim();
                payload.username = payload.email;
                payload.password = document.getElementById('regPassword').value;
            }

            // Attach practice or business details
            if (regState.accountType === 'accountant') {
                payload.practice = {
                    name:            document.getElementById('regPracticeName').value.trim(),
                    trading_name:    document.getElementById('regPracticeTradingName').value.trim(),
                    reg_number:      document.getElementById('regPracticeRegNumber').value.trim(),
                    tax_number:      document.getElementById('regPracticeTaxNumber').value.trim(),
                    practice_number: document.getElementById('regPracticeNumber').value.trim(),
                    phone:           document.getElementById('regPracticePhone').value.trim(),
                    address:         document.getElementById('regPracticeAddress').value.trim()
                };
            } else {
                payload.business = {
                    name:          document.getElementById('regCompanyName').value.trim(),
                    trading_name:  document.getElementById('regCompanyTradingName').value.trim(),
                    reg_number:    document.getElementById('regCompanyRegNumber').value.trim(),
                    tax_number:    document.getElementById('regCompanyTaxNumber').value.trim(),
                    vat_number:    document.getElementById('regCompanyVatNumber').value.trim(),
                    phone:         document.getElementById('regCompanyPhone').value.trim(),
                    address:       document.getElementById('regCompanyAddress').value.trim()
                };
            }

            try {
                const res = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Registration failed');

                const entityName = regState.accountType === 'accountant'
                    ? payload.practice.name
                    : payload.business.name;
                document.getElementById('regSuccessMsg').textContent =
                    `Your ${regState.accountType === 'accountant' ? 'practice' : 'business'} "${entityName}" has been created. You can now sign in with your credentials.`;
                goToStep(5);

            } catch (err) {
                toast(err.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Complete Registration';
            }
        }

        /* â”€â”€ fill login from registration â”€â”€ */
        function fillLoginFromReg() {
            const email = regState.accountMode === 'existing'
                ? (regState.existingUser ? regState.existingUser.email : '')
                : document.getElementById('regEmail').value.trim();
            if (email) document.getElementById('loginId').value = email;
        }

        /* â”€â”€ toast helper â”€â”€ */
        function toast(msg, type = 'info') {
            const el = document.getElementById('toast');
            el.textContent = msg;
            el.className = 'toast show ' + type;
            setTimeout(() => el.classList.remove('show'), 4000);
        }
    </script>
</body>
</html>